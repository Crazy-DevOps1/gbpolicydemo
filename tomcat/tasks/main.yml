---
# tasks file for tomcat
- name: Install Java
  ansible.builtin.yum:
     name: java
     state: installed
- name: Download the Tomcat Package
  ansible.builtin.get_url:
      url: "{{ tomcat_url }}" 
      dest: /opt
      mode: '0755'
- name: Untar the tomcat File
  ansible.builtin.unarchive:
      src: /opt/{{ tomcat_pck }}.tar.gz
      dest: /opt/
      remote_src: yes
- name: Chnage the Permision of the tomcat File
  ansible.builtin.file:
      path: /opt/{{ tomcat_pck }}/
      mode: '0755'
      recurse: yes
      state: directory
- name: Create the Link for the startup.sh
  ansible.builtin.file:
      src: /opt/{{ tomcat_pck }}/bin/startup.sh
      dest: /usr/local/bin/tomcatup
      state: link
- name: Create the Link for Shutdown.sh
  ansible.builtin.file:
      src: /opt/{{ tomcat_pck }}/bin/shutdown.sh
      dest: /usr/local/bin/tomcatdown
      state: link
- name: Ansible Template Context.xml
  ansible.builtin.copy:
      src: /opt/context.xml
      dest: /opt/{{ tomcat_pck }}/webapps/manager/META-INF
      mode: '0644'
      remote_src: yes
- name: Ansible Templete Tomcat-users.xml
  ansible.builtin.copy:
     src: /opt/tomcatuser.xml
     dest: /opt/{{ tomcat_pck }}/conf/tomcat-users.xml
     mode: '0644'
     remote_src: yes
- name: Ansible Copy WAR file to web apps
  command: ./copy_file.sh
  args:
    chdir: /opt/
- name: Delete the War file from OPT folder
  command: ./delete_file.sh
  args:
    chdir: /opt/
- name: Restart the Tomcat Server
  shell: /opt/{{ tomcat_pck }}/bin/shutdown.sh && nohup /opt/{{ tomcat_pck }}/bin/startup.sh
